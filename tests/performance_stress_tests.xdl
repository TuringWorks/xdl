; XDL Performance and Stress Test Suite
; Tests system performance with large datasets and complex algorithms
; Ensures XDL can handle real-world computational workloads

print, "=================================="
print, "XDL PERFORMANCE & STRESS TESTS"
print, "=================================="
print, ""

; =============================================================================
; LARGE DATASET OPERATIONS
; =============================================================================

print, "1. LARGE DATASET OPERATIONS"
print, "---------------------------"

; Large array creation and basic operations
print, "Large Array Creation:"
start_time = systime(/seconds)

large_size = 100000
large_array = findgen(large_size)

end_time = systime(/seconds)
creation_time = end_time - start_time

print, "  Created array of", large_size, "elements in", creation_time, "seconds"

; Large array summation
print, "Large Array Summation:"
start_time = systime(/seconds)

sum_result = 0.0
for i = 0L, large_size-1 do begin
  sum_result = sum_result + large_array[i]
endfor

end_time = systime(/seconds)
sum_time = end_time - start_time

analytical_sum = large_size * (large_size - 1) / 2.0
print, "  Computed sum:", sum_result
print, "  Analytical sum:", analytical_sum
print, "  Time taken:", sum_time, "seconds"
print, "  Error:", abs(sum_result - analytical_sum)

; Large array statistical operations
print, "Large Array Statistics:"
start_time = systime(/seconds)

mean_val = mean(large_array)
std_val = stddev(large_array)
min_val = min(large_array)
max_val = max(large_array)

end_time = systime(/seconds)
stats_time = end_time - start_time

print, "  Mean:", mean_val, "(expected:", (large_size-1)/2.0, ")"
print, "  StdDev:", std_val
print, "  Min:", min_val, "Max:", max_val
print, "  Statistics time:", stats_time, "seconds"

; =============================================================================
; MATRIX OPERATIONS STRESS TESTS
; =============================================================================

print, ""
print, "2. MATRIX OPERATIONS STRESS TESTS"
print, "---------------------------------"

; Large matrix creation
print, "Large Matrix Creation:"
matrix_size = 500
start_time = systime(/seconds)

large_matrix = findgen(matrix_size, matrix_size)

end_time = systime(/seconds)
matrix_creation_time = end_time - start_time

print, "  Created", matrix_size, "x", matrix_size, "matrix in", matrix_creation_time, "seconds"
print, "  Total elements:", matrix_size * matrix_size

; Matrix transpose performance
print, "Matrix Transpose Performance:"
start_time = systime(/seconds)

transposed_matrix = transpose(large_matrix)

end_time = systime(/seconds)
transpose_time = end_time - start_time

print, "  Transpose time:", transpose_time, "seconds"

; Matrix row/column operations
print, "Matrix Row/Column Operations:"
start_time = systime(/seconds)

row_sums = []
col_sums = []

; Calculate row sums
for i = 0, matrix_size-1 do begin
  row_sum = 0.0
  for j = 0, matrix_size-1 do begin
    row_sum = row_sum + large_matrix[i,j]
  endfor
  row_sums = [row_sums, row_sum]
endfor

; Calculate column sums
for j = 0, matrix_size-1 do begin
  col_sum = 0.0
  for i = 0, matrix_size-1 do begin
    col_sum = col_sum + large_matrix[i,j]
  endfor
  col_sums = [col_sums, col_sum]
endfor

end_time = systime(/seconds)
row_col_time = end_time - start_time

print, "  Row/column operations time:", row_col_time, "seconds"
print, "  Sample row sums:", row_sums[0:4]
print, "  Sample col sums:", col_sums[0:4]

; =============================================================================
; NESTED LOOP PERFORMANCE TESTS
; =============================================================================

print, ""
print, "3. NESTED LOOP PERFORMANCE TESTS"
print, "-------------------------------"

; Triple nested loops
print, "Triple Nested Loops:"
iterations = 0
start_time = systime(/seconds)

for i = 1, 50 do begin
  for j = 1, 50 do begin
    for k = 1, 50 do begin
      iterations = iterations + 1
    endfor
  endfor
endfor

end_time = systime(/seconds)
nested_time = end_time - start_time

print, "  Total iterations:", iterations
print, "  Time taken:", nested_time, "seconds"
print, "  Iterations per second:", iterations / nested_time

; Nested loops with computations
print, "Nested Loops with Computations:"
start_time = systime(/seconds)

result_matrix = fltarr(100, 100)
for i = 0, 99 do begin
  for j = 0, 99 do begin
    ; Complex computation
    x = i / 100.0
    y = j / 100.0
    result_matrix[i,j] = sin(x * !pi) * cos(y * !pi) + exp(-(x^2 + y^2))
  endfor
endfor

end_time = systime(/seconds)
computation_time = end_time - start_time

print, "  100x100 computation matrix created in", computation_time, "seconds"
print, "  Sample values: [0,0] =", result_matrix[0,0], "[50,50] =", result_matrix[50,50]

; =============================================================================
; MEMORY STRESS TESTS
; =============================================================================

print, ""
print, "4. MEMORY STRESS TESTS"
print, "----------------------"

; Multiple large arrays
print, "Multiple Large Arrays:"
start_time = systime(/seconds)

arrays = []
array_count = 10
array_size = 50000

for i = 1, array_count do begin
  new_array = findgen(array_size) * i
  arrays = [arrays, new_array]
endfor

end_time = systime(/seconds)
memory_time = end_time - start_time

total_elements = array_count * array_size
print, "  Created", array_count, "arrays with", total_elements, "total elements"
print, "  Memory allocation time:", memory_time, "seconds"

; Array operations on multiple arrays
print, "Operations on Multiple Arrays:"
start_time = systime(/seconds)

combined_sum = 0.0
for i = 0, array_count-1 do begin
  combined_sum = combined_sum + total(arrays[i,*])
endfor

end_time = systime(/seconds)
operation_time = end_time - start_time

print, "  Combined sum of all arrays:", combined_sum
print, "  Operation time:", operation_time, "seconds"

; =============================================================================
; ALGORITHM COMPLEXITY TESTS
; =============================================================================

print, ""
print, "5. ALGORITHM COMPLEXITY TESTS"
print, "-----------------------------"

; O(n^2) algorithm - matrix multiplication simulation
print, "O(n^2) Algorithm - Matrix Operations:"
n = 200
start_time = systime(/seconds)

A = findgen(n, n)
B = findgen(n, n) + 1
C = fltarr(n, n)

for i = 0, n-1 do begin
  for j = 0, n-1 do begin
    sum = 0.0
    for k = 0, n-1 do begin
      sum = sum + A[i,k] * B[k,j]
    endfor
    C[i,j] = sum
  endfor
endfor

end_time = systime(/seconds)
matrix_mult_time = end_time - start_time

print, "  ", n, "x", n, "matrix multiplication in", matrix_mult_time, "seconds"
print, "  Operations performed:", n * n * n
print, "  Operations per second:", (n * n * n) / matrix_mult_time

; Sorting algorithm performance
print, "Sorting Algorithm Performance:"
unsorted = randomu(seed, 10000) * 1000
start_time = systime(/seconds)

sorted = sort(unsorted)

end_time = systime(/seconds)
sort_time = end_time - start_time

print, "  Sorted 10,000 elements in", sort_time, "seconds"
print, "  First 5 sorted values:", sorted[0:4]
print, "  Last 5 sorted values:", sorted[995:999]

; =============================================================================
; CONCURRENT OPERATIONS SIMULATION
; =============================================================================

print, ""
print, "6. CONCURRENT OPERATIONS SIMULATION"
print, "-----------------------------------"

; Simulate multiple independent computations
print, "Multiple Independent Computations:"
start_time = systime(/seconds)

results1 = []
results2 = []
results3 = []

; Computation 1: Factorials
for i = 1, 100 do begin
  fact = 1.0
  for j = 1, i do begin
    fact = fact * j
  endfor
  results1 = [results1, fact]
endfor

; Computation 2: Fibonacci numbers
fib_a = 0
fib_b = 1
for i = 1, 100 do begin
  temp = fib_a + fib_b
  fib_a = fib_b
  fib_b = temp
  results2 = [results2, fib_b]
endfor

; Computation 3: Prime counting
prime_count = 0
for num = 2, 1000 do begin
  is_prime = 1
  for divisor = 2, sqrt(num) do begin
    if num mod divisor eq 0 then begin
      is_prime = 0
      break
    endif
  endfor
  if is_prime then prime_count = prime_count + 1
endfor
results3 = [prime_count]

end_time = systime(/seconds)
concurrent_time = end_time - start_time

print, "  Sequential computations completed in", concurrent_time, "seconds"
print, "  Factorial of 10:", results1[9]
print, "  10th Fibonacci number:", results2[9]
print, "  Prime count up to 1000:", results3[0]

; =============================================================================
; STRESS TEST WITH ERROR CONDITIONS
; =============================================================================

print, ""
print, "7. STRESS TEST WITH ERROR CONDITIONS"
print, "------------------------------------"

; Operations that might cause issues
print, "Error Condition Handling:"
start_time = systime(/seconds)

error_count = 0
success_count = 0

for i = 1, 1000 do begin
  ; Random operations that might fail
  operation_type = fix(randomu(seed) * 4)

  case operation_type of
    0: begin
      ; Array access
      test_arr = findgen(100)
      idx = fix(randomu(seed) * 150)  ; May be out of bounds
      if idx lt n_elements(test_arr) then begin
        val = test_arr[idx]
        success_count = success_count + 1
      endif else begin
        error_count = error_count + 1
      endelse
    end

    1: begin
      ; Division
      numerator = randomu(seed) * 100
      denominator = randomu(seed) * 10  ; May be zero
      if denominator ne 0 then begin
        result = numerator / denominator
        success_count = success_count + 1
      endif else begin
        error_count = error_count + 1
      endelse
    end

    2: begin
      ; Mathematical functions
      x = (randomu(seed) - 0.5) * 10
      if x ge 0 then begin
        result = sqrt(x)
        success_count = success_count + 1
      endif else begin
        error_count = error_count + 1
      endelse
    end

    3: begin
      ; Array operations
      size1 = fix(randomu(seed) * 50) + 1
      size2 = fix(randomu(seed) * 50) + 1
      arr1 = findgen(size1)
      arr2 = findgen(size2)
      if size1 eq size2 then begin
        result = arr1 + arr2
        success_count = success_count + 1
      endif else begin
        error_count = error_count + 1
      endelse
    end
  endcase
endfor

end_time = systime(/seconds)
stress_time = end_time - start_time

print, "  Stress test completed in", stress_time, "seconds"
print, "  Successful operations:", success_count
print, "  Error conditions handled:", error_count
print, "  Total operations:", success_count + error_count

; =============================================================================
; MEMORY CLEANUP AND FINALIZATION
; =============================================================================

print, ""
print, "8. MEMORY CLEANUP AND FINALIZATION"
print, "----------------------------------"

; Clean up large variables
print, "Memory cleanup:"
large_array = 0
large_matrix = 0
transposed_matrix = 0
result_matrix = 0
arrays = 0

print, "  Large variables cleared"

; Final memory check
print, "Final memory status:"
print, "  Test completed successfully"

; =============================================================================
; PERFORMANCE SUMMARY
; =============================================================================

print, ""
print, "=================================="
print, "PERFORMANCE & STRESS TEST SUMMARY"
print, "=================================="
print, ""
print, "Performance Metrics:"
print, "- Large array operations: ✓"
print, "- Matrix computations: ✓"
print, "- Nested loop performance: ✓"
print, "- Memory stress tests: ✓"
print, "- Algorithm complexity: ✓"
print, "- Concurrent operations: ✓"
print, "- Error condition handling: ✓"
print, ""
print, "XDL successfully handles:"
print, "- Arrays with 100,000+ elements"
print, "- 500x500 matrices"
print, "- Complex nested algorithms"
print, "- Memory-intensive operations"
print, "- Error-prone computations"
print, ""
print, "All performance and stress tests PASSED!"